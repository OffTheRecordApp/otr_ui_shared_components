"use strict";function fuseHighlightDirective(){return{restrict:"A",link:function(t,e,r){for(var t=t.result,o=r.fuseHighlightBind,n=r.fuseHighlightKey,s=r.fuseHighlightBestMatch,i="",c=0,u=_.chain(t).get("originalObject.matches",[]).filter(function(t){return!n||t.key===n}).map("indices").flatten().value(),a=_.chain(u).map(function(t){return 1+_.last(t)-_.first(t)}).max().value(),l=0;l<u.length;l++){var h=_.first(u[l])||0,d=1+_.last(u[l]),f=d-h;c<=h&&(i+=o.slice(c,h),i+=!s&&a/2<f||s&&f===a?'<span class="highlight">'+o.slice(h,d)+"</span>":o.slice(h,d),c=d)}i+=o.slice(c),e.html(i)}}}angular.module("otrSharedComponents",["otrSharedComponents.tpls","courtsDropdown"]),angular.module("otrSharedComponents").directive("otrFuseHighlight",fuseHighlightDirective);var __awaiter=this&&this.__awaiter||function(t,i,c,u){return new(c=c||Promise)(function(r,e){function o(t){try{s(u.next(t))}catch(t){e(t)}}function n(t){try{s(u.throw(t))}catch(t){e(t)}}function s(t){var e;t.done?r(t.value):((e=t.value)instanceof c?e:new c(function(t){t(e)})).then(o,n)}s((u=u.apply(t,i||[])).next())})},__generator=this&&this.__generator||function(r,o){var n,s,i,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,s&&(i=2&e[0]?s.return:e[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,e[1])).done)return i;switch(s=0,(e=i?[2&e[0],i.value]:e)[0]){case 0:case 1:i=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,s=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(!(i=0<(i=c.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){c=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){c.label=e[1];break}if(6===e[0]&&c.label<i[1]){c.label=i[1],i=e;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(e);break}i[2]&&c.ops.pop(),c.trys.pop();continue}e=o.call(r,c)}catch(t){e=[6,t],s=0}finally{n=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},ctrl=null,CourtsDropdownComponent=function(){this.bindings={onSelectCourt:"&",inputClass:"@",hasError:"<",state:"@"},this.controller=CourtsDropdownCtrl,this.controllerAs="vm",this.templateUrl="/components/courts-dropdown/courts-dropdown.component.html"},CourtsDropdownCtrl=function(){function t(t){this.API_ENDPOINT="https://otr-backend-service-us-prod.offtherecord.com",this.inputClass="",this.hasError=!1,this.classes=this.inputClass,this.isCourtsLoading=!1,this.otrService=new t({domain:this.API_ENDPOINT})}return t.prototype.$onInit=function(){ctrl=this},t.prototype.$onChanges=function(t){var e=this;t.hasError&&(this.classes=this.inputClass+(this.hasError?" has-error":"")),t.state&&this.state&&this.fetchCourts().then(function(t){return e.initFuse(angular.copy(t))})},t.prototype.fetchCourts=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.otrService?(this.isCourtsLoading=!0,[4,this.otrService.findCourtsUsingGET({state:this.state})]):[3,2];case 1:return e=t.sent(),this.courts=_.forEach(e.data.courts,function(t){t.customTitle=t.courtName,t.customTitle+=t.courtNameAdditional?" – "+t.courtNameAdditional:"",t.customTitle+=t.courtCode?" ("+t.courtCode+")":"",t.customDescription=t.address.city+", "+t.address.regionCode+" "+t.address.postalCode+" – "+t.address.countyName+" County"}),this.isCourtsLoading=!1,[2,this.courts];case 2:throw"Error instantiating otrService"}})})},t.prototype.initFuse=function(t){try{this.fuseAllKeys=new Fuse(t,{includeMatches:!0,includeScore:!0,distance:2e3,threshold:.5,keys:["customTitle","customDescription"]})}catch(t){throw"Dependency fuse.js required"}try{this.fuseCourtCode=new Fuse(t,{includeMatches:!0,includeScore:!0,distance:10,threshold:.1,keys:["courtCode"]})}catch(t){throw"Dependency fuse.js required"}},t.prototype.findMatchingCourts=function(t){var e=_.sortBy(ctrl.fuseAllKeys.search(t),"courtId"),t=_.sortBy(ctrl.fuseCourtCode.search(t),"courtId");return _.chain(e).unionWith(t,function(t,e){var r=t.item.courtId===e.item.courtId;return r&&(e.score=_.min([t.score,e.score])),r}).sortBy("score").take(600).map(function(t){return t.item.matches=t.matches,t.item}).value()},t.$inject=["OtrService"],t}();angular.module("courtsDropdown",[]).component("courtsDropdown",new CourtsDropdownComponent);