"use strict";function fuseHighlightDirective(){return{restrict:"A",link:function(t,e,r){for(var t=t.result,n=r.fuseHighlightBind,o=r.fuseHighlightKey,i=r.fuseHighlightBestMatch,s="",c=0,a=_.chain(t).get("originalObject.matches",[]).filter(function(t){return!o||t.key===o}).map("indices").flatten().value(),u=_.chain(a).map(function(t){return 1+_.last(t)-_.first(t)}).max().value(),h=0;h<a.length;h++){var l=_.first(a[h])||0,d=1+_.last(a[h]),p=d-l;c<=l&&(s+=n.slice(c,l),s+=!i&&u/2<p||i&&p===u?'<span class="highlight">'+n.slice(l,d)+"</span>":n.slice(l,d),c=d)}s+=n.slice(c),e.html(s)}}}angular.module("otr-ui-shared-components",["angucomplete-alt","otrBackendService","otr-ui-shared-components.tpls"]),angular.module("otr-ui-shared-components").directive("otrFuseHighlight",fuseHighlightDirective);var OtrServiceProvider=function(){function t(){var n=this;this.$get=["OtrService",function(t){if(!n._otrServiceInstance){var e={domain:n._domain};if(!n._domain){var r="Domain has not been set in app config";throw console.error(r),r}n._cache&&(e.cache=n._cache),n._token&&(e.token=n._token),n._otrServiceInstance=new t(e)}return n._otrServiceInstance}]}return t.prototype.setDomain=function(t){this._domain=t},t.prototype.setCache=function(t){this._cache=t},t.prototype.setToken=function(t){this._token=t},t}();angular.module("otr-ui-shared-components").provider("otrService",OtrServiceProvider);var __awaiter=this&&this.__awaiter||function(t,s,c,a){return new(c=c||Promise)(function(r,e){function n(t){try{i(a.next(t))}catch(t){e(t)}}function o(t){try{i(a.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof c?e:new c(function(t){t(e)})).then(n,o)}i((a=a.apply(t,s||[])).next())})},__generator=this&&this.__generator||function(r,n){var o,i,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&e[0]?i.return:e[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,e[1])).done)return s;switch(i=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,i=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){c=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){c.label=e[1];break}if(6===e[0]&&c.label<s[1]){c.label=s[1],s=e;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(e);break}s[2]&&c.ops.pop(),c.trys.pop();continue}e=n.call(r,c)}catch(t){e=[6,t],i=0}finally{o=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},CourtsDropdownCtrl=function(){function t(t,e){this.$scope=t,this.otrService=e,this.inputClass="",this.hasError=!1,this.classes=this.inputClass,this.isDataLoading=!1,this.findMatchingCourts=this.findMatchingCourts.bind(this)}return t.prototype.$onInit=function(){},t.prototype.$onChanges=function(t){var e=this;t.hasError&&(this.classes=this.inputClass+(this.hasError?" has-error":"")),t.state&&this.state&&this.fetchCourts().then(function(t){return e.initFuse(angular.copy(t))})},t.prototype.fetchCourts=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,,2,3]),this.isDataLoading=!0,[4,this.otrService.findCourtsUsingGET({state:this.state})];case 1:return e=t.sent(),this.courts=_.forEach(e.data.courts,function(t){t.customTitle=t.courtName,t.customTitle+=t.courtNameAdditional?" – "+t.courtNameAdditional:"",t.customTitle+=t.courtCode?" ("+t.courtCode+")":"",t.customDescription=t.address.city+", "+t.address.regionCode+" "+t.address.postalCode+" – "+t.address.countyName+" County"}),[2,this.courts];case 2:return this.isDataLoading=!1,this.$scope.$apply(),[7];case 3:return[2]}})})},t.prototype.initFuse=function(t){try{this.fuseAllKeys=new Fuse(t,{includeMatches:!0,includeScore:!0,distance:2e3,threshold:.5,keys:["customTitle","customDescription"]})}catch(t){throw"Dependency fuse.js required"}try{this.fuseCourtCode=new Fuse(t,{includeMatches:!0,includeScore:!0,distance:10,threshold:.1,keys:["courtCode"]})}catch(t){throw"Dependency fuse.js required"}},t.prototype.findMatchingCourts=function(t){var e=_.sortBy(this.fuseAllKeys.search(t),"courtId"),t=_.sortBy(this.fuseCourtCode.search(t),"courtId");return _.chain(e).unionWith(t,function(t,e){var r=t.item.courtId===e.item.courtId;return r&&(e.score=_.min([t.score,e.score])),r}).sortBy("score").take(600).map(function(t){return t.item.matches=t.matches,t.item}).value()},t}();angular.module("otr-ui-shared-components").component("appCourtsDropdown",{controller:CourtsDropdownCtrl,controllerAs:"vm",templateUrl:"app/components/courts-dropdown/courts-dropdown.component.html",bindings:{onSelectCourt:"&",inputClass:"@",hasError:"<",state:"@"}}),CourtsDropdownCtrl.$inject=["$scope","otrService"];